# i3status GPU nvidia

Скрипт для вывода температуры, памяти и загруженности GPU nvidia (проприетарные драйвера) протестировано на GeForce GTX 1650 и GTX 650 Ti.

![изображение](https://user-images.githubusercontent.com/132225093/235750459-916ef8ca-b932-497c-a2c3-a023a06d0e1a.png)


Краткое описание:

Так как sensors температуру видеокарты не выводит, а для i3status штатного решения нет, решил я сделать свой скрипт, в общем, отталкивался я от команды 
nvidia-smi -q -d TEMPERATURE -f ~/.config/i3status/gpu_t/GPU и nvidia-smi -q -d UTILIZATION -f ~/.config/i3status/gpu_t/GPU1,nvidia-smi -q -d MEMORY -f ~/.config/i3status/gpu_t/GPU3, первая выводит температуру, вторая загруженность, а третья память видеокарты, ключ -f организует запись в файл. Выводит оно, естественно, не самым корректным образом:  
![изображение](https://user-images.githubusercontent.com/132225093/235371463-31a277ae-bc6e-4282-83be-fff76c6e1770.png)

ну и UTILIZATION с MEMORY аналогично. Выход я нашел (не знаю правда на сколько эффективный), написал три простые програмки на СИ посредством которых мне удалось "вытащить" только нужные цифры и записать их в отдельные файлы. Файл script.sh выглядит следующим образом: 

![изображение](https://user-images.githubusercontent.com/132225093/235751530-2db31353-f6e9-4f88-9a97-ebf683ebc67d.png)


где первые три строки это то что я описал выше, за ними запускаются программы GPU.out, GPU_util.out и GPU_mem.out которые сохраняют необходимую нам строки в отдельные файлы.
Пример GPU.out:

![изображение](https://user-images.githubusercontent.com/132225093/235371958-a04c52c4-abc4-46fa-8329-2fcd6c42364e.png)

Файл temp содержит вывод GPU.out, util вывод GPU_util.out, а mem вывод GPU_mem.out (температура, загруженность и память соответственно). 

Далее добавил все это в config i3status 

![изображение](https://user-images.githubusercontent.com/132225093/235752053-618c3e83-ecb5-45d3-899b-3638ce262a2d.png)

![изображение](https://user-images.githubusercontent.com/132225093/235752159-7912679c-fece-4106-b7bc-d11fc6e00ea7.png)


Дальше стал вопрос как это автоматически запускать с определенной частотой, например 5 секунд? Сделал следующие, создал еще один sh файл auto.sh где прописал : watch -n 5 sh ~/.config/i3status/gpu_t/script.sh, 

wath -n 5 обеспечивает запуск скрипта через каждые n-секунд (в нашем случае 5 секунд), и добавил это дело в конфиг i3 для автозапуска при включении ПК: 

exec --no-startup-id ~/.config/i3status/gpu_t/auto.sh. 

Все, после перезагрузки скрипт работает. Единственный наверно минус (хотя я думаю не существенный) это постоянная запись на диск, 15-20 КиБ/каждые пять секунд, (firefox пишет в разы больше, поэтому можно забить). 

Максимальное количество видеопамяти пишем руками в конфиге i3status (если что он тоже прикреплен)

P.S. ОБЯЗАТЕЛЬНО ИЗМЕНИТЕ ПУТИ К ФАЙЛАМ, И СКОМПИЛИРУЙТЕ GPU_temp.c, GPU_mem.с и GPU_util.c СО СВОИМИ ПУТЯМИ К ФАЙЛАМ.

Компиляция происходит следующим образом (для тех кто не в курсе):

gcc  GPU.c

После создается файл .out (обычно а.out) переименовываем файлы на нужные (GPU.out GPU_util.out GPU_mem.out) 
если не запускается раздайте каждой программе права 

chmod +x имя_файла


